

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="Description" content="Ember.js的中文开发者交流平台，提供Ember.js官方网站指南和API的中文翻译，持续关注最近的社区动态，为您提供高质量的Ember.js中文资料。 " />
    <meta name="Keywords" content="Ember.js、Ember、Javascript、Javascript框架、HTML、论坛、博客、中文社区" />
    <title>Ember.js - 集成测试</title>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <!--[if lte IE 7 ]><link href="/stylesheets/fonts/fontello-ie7.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/emberjs-cn.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://emberjs.cn/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js CN - 博客" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-38578402-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

<!--[if lt IE 9]>
    <script type="text/javascript" src="/javascripts/common-old-ie.js"></script>
<![endif]-->
<!--[if gte IE 9]><!-->
    <script type="text/javascript" src="/javascripts/common-modern.js"></script>
<!--<![endif]-->

    
    <script type="text/javascript" src="/javascripts/guides.js"></script>
  
  </head>

  <body class="bilingual_guides bilingual_guides_testing bilingual_guides_testing_integration bilingual_guides_testing_integration_index">
    <div id="header">
      <div id="wrapper">
        <a id="logo" href="/">&nbsp;</a>
        <ul id="nav">
          <li><a href="/guides">指南</a></li>
          <li><a href="/blog">博客</a></li>
          <li>
            <a target="_blank" href="http://discuss.emberjs.cn">论坛</a>
          </li>
          <li><a href="/builds">构建</a></li>
        </ul>
        <div id="github">
          <a href="https://github.com/emberjs-cn"><img src="/images/fork-us.png">Fork Us!</a>
          <a href="https://github.com/emberjs/ember.js"><img src="/images/fork-us.png">Fork Ember!</a>
        </div>
      </div>
    </div>

    <div id="content-wrapper">
      
      
        <div id="sidebar">
          
    <ol id="toc-list">
          <li class="level-1">
            <a href="/bilingual_guides/getting-started">入门指南</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/getting-started">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/planning-the-application">应用规划</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/creating-a-static-mockup">创建静态页面</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/obtaining-emberjs-and-dependencies">获取Ember.js和相应依赖</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/adding-a-route-and-template">添加第一个路由与模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/modeling-data">建立模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/using-fixtures">使用静态数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-model-data">显示模型数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-a-models-completeness">显示模型的完成状态</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/creating-a-new-model">创建新的模型实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/marking-a-model-as-complete-incomplete">标记模型为完成或未完成</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-the-number-of-incomplete-todos">显示未完成待办事项的数量</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/toggle-todo-editing-state">切换显示和编辑状态</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/accepting-edits">接受修改</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/deleting-todos">删除模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/adding-child-routes">添加子路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-only-incomplete-todos">显示未完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-only-complete-todos">显示已完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-all-todos-again">显示所有待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/display-a-button-to-remove-completed-todos">添加移除所有已完成待办事项的按钮</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-when-all-todos-are-complete">提示所有待办事项已完成</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/toggle-all-todos">切换已完成和未完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/using-other-adapters">更换FixtureAdapter</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/concepts/core-concepts">概念</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/concepts/core-concepts">核心概念</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/concepts/naming-conventions">命名惯例</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/object-model/classes-and-instances">对象模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/object-model/classes-and-instances">类与实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties">计算属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties-and-aggregate-data">计算属性和带@each的集合数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/observers">观察器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/bindings">绑定</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/reopening-classes-and-instances">重新打开类和实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/what-do-i-use-when">绑定，观察器，计算属性：如何选择？</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/application">应用</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/application">介绍</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/templates/the-application-template">模板</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/templates/the-application-template">应用模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/handlebars-basics">Handlebars基础</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/conditionals">条件表达式</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/displaying-a-list-of-items">显示项目列表</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/changing-scope">切换作用域</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-attributes">绑定元素属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-class-names">绑定元素类名称</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/links">链接</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/actions">操作</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/input-helpers">Input Helpers</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/rendering-with-helpers">用助手来渲染</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/writing-helpers">编写助手方法</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/routing">路由</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/routing">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/defining-your-routes">定义路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/generated-objects">生成的对象</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-a-routes-model">指定路由的模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/setting-up-a-controller">设置控制器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/rendering-a-template">渲染模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/redirection">重定向</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-the-location-api">指定地址API</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/query-params">Query Parameters</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/asynchronous-routing">Asynchronous Routing</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/loading-and-error-substates">Loading / Error Substates</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/preventing-and-retrying-transitions">Preventing and Retrying Transitions</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/components">组件</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/components">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/defining-a-component">定义组件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/passing-properties-to-a-component">传递属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/wrapping-content-in-a-component">包裹内容</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/customizing-a-components-element">自定义组件元素</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/handling-user-interaction-with-actions">使用Action处理用户交互</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/sending-actions-from-components-to-your-application">Sending Actions from Components to Your Application</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/controllers">控制器</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/controllers">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-a-single-model-with-objectcontroller">代表单一模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-multiple-models-with-arraycontroller">代表多模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/dependencies-between-controllers">管理控制器间的依赖</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/models">模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/models">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/defining-models">定义模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/creating-and-deleting-records">创建和删除记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/pushing-records-into-the-store">将记录推入仓库</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/persisting-records">持久化记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/finding-records">查询记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/working-with-records">使用记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/connecting-to-an-http-server">连接HTTP服务器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/handling-metadata">处理元数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/frequently-asked-questions">常见问题</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/views">视图</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/views">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/defining-a-view">定义视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/handling-events">处理事件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/inserting-views-in-templates">在模板中插入视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/adding-layouts-to-views">为视图添加布局</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/customizing-a-views-element">自定义视图元素</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/built-in-views">内置视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/manually-managing-view-hierarchy">手动管理视图层级</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/enumerables">枚举</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/enumerables">介绍</a>
            </li>
          </ol></li>
          <li class="level-1 selected">
            <a href="/bilingual_guides/testing/integration">测试</a>
            <ol class='selected'>
        
            <li class="level-3 sub-selected">
              <a href="/bilingual_guides/testing/integration">集成测试</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">配置Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">禁用基本类型扩展</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/embedding-applications">嵌入式应用</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/feature-flags">特性标识</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/cookbook">Cookbook</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/cookbook">简介</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/user_interface_and_interaction">用户界面与交互</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/event_handling_and_data_binding">事件处理和数据绑定</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/helpers_and_components">助手与组件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/working_with_objects">使用对象</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/understanding-ember/the-view-layer">理解Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/the-view-layer">视图层</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/managing-asynchrony">管理异步</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/keeping-templates-up-to-date">模板自动更新</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/debugging">调试</a>
            </li>
          </ol></li></ol>
  
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; 返回顶部</a></div>
        </div>
      
      <div id="content" class="has-sidebar">
          
  

  <div class="chapter">
    
        <h1>集成测试 
          <a href="https://github.com/emberjs-cn/www.emberjs.cn/tree/master/source/guides/testing/integration.md" target="_blank" class="edit-page">
            编辑页面</a>
        </h1>
      
    <p>Ember includes several helpers to facilitate integration testing. These helpers are &quot;aware&quot; of (and wait for) asynchronous behavior within your application, making it much easier to write deterministic tests.</p>

<p>Ember包含了需要用来帮助完成集成测试的助手。这些助手能自动识别（等待）应用中的异步行为，这使得编写确定性测试更加容易。</p>

<p><a href="http://qunitjs.com/">QUnit</a> is the default testing framework for this package, but others are supported through third-party adapters.</p>

<p><a href="http://qunitjs.com/">QUnit</a>是Ember默认使用的测试框架，其他的框架也可以通过第三方的适配器来得到支持。</p>
<h3 class='anchorable-toc' id='toc_setup'>Setup</h3><h3 class='anchorable-toc' id='toc_'>设置</h3>
<p>In order to integration test the Ember application, you need to run the app within your test framework. Set the root element of the application to an arbitrary element you know will exist. It is useful, as an aid to test-driven development, if the root element is visible while the tests run. You can potentially use #qunit-fixture, typically used to contain fixture html for use in tests, but you will need to override css to make it visible.</p>

<p>为了对Ember应用进行集成测试，需要在测试框架中运行应用。首先需要将根元素（root element）设置为任意一个已知将存在的元素。如果根元素在测试运行时可见的话，这对测试驱动开发非常有用，带来的帮助非常明显。这里可以使用<code>#qunit-fixture</code>，这个元素通常用来包含在测试中需要使用的html，不过需要重写CSS样式，以便其在测试过程中可见。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>App.rootElement = <span class="string"><span class="delimiter">'</span><span class="content">#arbitrary-element-to-contain-ember-application</span><span class="delimiter">'</span></span>;
</pre></td>
</tr></table>
</div></div>
<p>This hook defers the readiness of the application, so that you can start the app when your tests are ready to run. It also sets the router&#39;s location to &#39;none&#39;, so that the window&#39;s location will not be modified (preventing both accidental leaking of state between tests and interference with your testing framework).</p>

<p>下面的钩子会延迟准备应用，以便当测试准备好运行的时候才启动应用。钩子还负责将路由的地址（location）设置为<code>none</code>，这样浏览器窗口的地址就不会被修改（这样避免了测试和测试框架之间的状态冲突）。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>App.setupForTesting();
</pre></td>
</tr></table>
</div></div>
<p>This injects the test helpers into the window&#39;s scope.</p>

<p>下面的代码完成将测试助手注入到<code>window</code>作用域。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
</pre></td>
  <td class="code"><pre>App.injectTestHelpers();
</pre></td>
</tr></table>
</div></div>
<p>With QUnit, <code>setup</code> and <code>teardown</code> functions are defined in each test module&#39;s configuration. These functions are called for each test in the module. If you are using a framework other than QUnit, use the hook that is called before each individual test.</p>

<p>QUnit中，<code>setup</code>和<code>teardown</code>函数在每个测试模块的配置中被定义。上面两个函数在模块中每个测试进行时被调用。如果使用了QUnit之外的其他测试框架，那么需要在每个测试运行之前的钩子中调用上面两个函数来完成设置。</p>

<p>Before each test, reset the application: <code>App.reset()</code> completely resets the state of the application.</p>

<p>每个测试开始前，还需要通过<code>App.reset()</code>重置整个应用，这样可以恢复应用的所有状态。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>module(<span class="string"><span class="delimiter">&quot;</span><span class="content">Integration Tests</span><span class="delimiter">&quot;</span></span>, {
  <span class="function">setup</span>: <span class="keyword">function</span>() {
    App.reset();
  }
});
</pre></td>
</tr></table>
</div></div><h3 class='anchorable-toc' id='toc_helpers'>Helpers</h3><h3 class='anchorable-toc' id='toc_'>助手</h3>
<ul>
<li><p><code>visit(url)</code> - Visits the given route and returns a promise that fulfills when all resulting async behavior is complete.</p></li>
<li><p><code>visit(url)</code> - 访问指定的路由并返回一个将在所有异步行为完成后得到履行的承诺。</p></li>
<li><p><code>find(selector, context)</code> - Finds an element within the app&#39;s root element and within the context (optional). Scoping to the root element is especially useful to avoid conflicts with the test framework&#39;s reporter.</p></li>
<li><p><code>find(selector, context)</code> - 在应用的根元素中找到指定上下文（可选）的一个元素。限定到根元素可以有效的避免与测试框架的报告发生冲突。</p></li>
<li><p><code>fillIn(input_selector, text)</code> - Fills in the selected input with the given text and returns a promise that fulfills when all resulting async behavior is complete.</p></li>
<li><p><code>fillIn(input_selector, text)</code> - 在选定的输入出填入给定的文本，并返回一个在所有异步行为完成后会履行的承诺。</p></li>
<li><p><code>click(selector)</code> - Clicks an element and triggers any actions triggered by the element&#39;s <code>click</code> event and returns a promise that fulfills when all resulting async behavior is complete.</p></li>
<li><p><code>click(selector)</code> -
点击选定的元素，触发元素<code>click</code>事件会触发的所有操作，并返回一个在所有异步行为完成后会履行的承诺。</p></li>
<li><p><code>keyEvent(selector, type, keyCode)</code> - Simulates a key event type, e.g. <code>keypress</code>, <code>keydown</code>, <code>keyup</code> with the desired keyCode on element found by the selector.</p></li>
<li><p><code>keyEvent(selector, type, keyCode)</code> -
模拟一个键盘事件，例如：在选定元素上的带有<code>keyCode</code>的<code>keypress</code>，<code>keydown</code>，<code>keyup</code>事件。</p></li>
<li><p><code>wait()</code> - Returns a promise that fulfills when all async behavior is complete.</p></li>
<li><p><code>wait()</code> - 返回一个在所有异步行为完成后会履行的承诺。</p></li>
</ul>
<h3 class='anchorable-toc' id='toc_writing-tests'>Writing tests</h3><h3 class='anchorable-toc' id='toc_'>编写测试</h3>
<p>Almost every test has a pattern of visiting a route, interacting with the page (using the helpers), and checking for expected changes in the DOM.</p>

<p>几乎每个测试都遵循一个固定的模式，访问一个路由，与打开的页面进行交互（通过测试助手），最后检验期望的DOM改变是否发生。</p>

<p>Examples:</p>

<p>例子：</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre>test(<span class="string"><span class="delimiter">&quot;</span><span class="content">root lists first page of posts</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(){
  visit(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>).then(<span class="keyword">function</span>() {
    equal(find(<span class="string"><span class="delimiter">&quot;</span><span class="content">.post</span><span class="delimiter">&quot;</span></span>).length, <span class="integer">5</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">The first page should have 5 posts</span><span class="delimiter">&quot;</span></span>);
    <span class="comment">// Assuming we know that 5 posts display per page and that there are more than 5 posts</span>
  });
});
</pre></td>
</tr></table>
</div></div>
<p>The helpers that perform actions return a promise that fulfills when all asynchronous behavior has completed.</p>

<p>执行操作的测试助手都会返回在所有异步行为完成后会履行的承诺。</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
12
</pre></td>
  <td class="code"><pre>test(<span class="string"><span class="delimiter">&quot;</span><span class="content">creating a post displays the new post</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>(){
  visit(<span class="string"><span class="delimiter">&quot;</span><span class="content">/posts/new</span><span class="delimiter">&quot;</span></span>).then(<span class="keyword">function</span>() {
    <span class="keyword">return</span> fillIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">.post-title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A new post</span><span class="delimiter">&quot;</span></span>);
  }).then(<span class="keyword">function</span>() {
    <span class="keyword">return</span> fillIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">.post-author</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>);
  }).then(<span class="keyword">function</span>() {
    <span class="keyword">return</span> click(<span class="string"><span class="delimiter">&quot;</span><span class="content">button.create</span><span class="delimiter">&quot;</span></span>);
  }).then(<span class="keyword">function</span>() {
    ok(find(<span class="string"><span class="delimiter">&quot;</span><span class="content">h1:contains('A new post')</span><span class="delimiter">&quot;</span></span>).length, <span class="string"><span class="delimiter">&quot;</span><span class="content">The post's title should display</span><span class="delimiter">&quot;</span></span>);
    ok(find(<span class="string"><span class="delimiter">&quot;</span><span class="content">a[rel=author]:contains('John Doe')</span><span class="delimiter">&quot;</span></span>).length, <span class="string"><span class="delimiter">&quot;</span><span class="content">A link to the author should display</span><span class="delimiter">&quot;</span></span>);
  });
});
</pre></td>
</tr></table>
</div></div>
<p>For convenience, helpers can be chained:</p>

<p>为了方便，测试助手还可以进行链式调用：</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
</pre></td>
  <td class="code"><pre>test(<span class="string"><span class="delimiter">&quot;</span><span class="content">creating a post displays the new post</span><span class="delimiter">&quot;</span></span>, <span class="keyword">function</span>() {
  visit(<span class="string"><span class="delimiter">&quot;</span><span class="content">/posts/new</span><span class="delimiter">&quot;</span></span>)
  .fillIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">.post-title</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">A new post</span><span class="delimiter">&quot;</span></span>)
  .fillIn(<span class="string"><span class="delimiter">&quot;</span><span class="content">.post-author</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">John Doe</span><span class="delimiter">&quot;</span></span>)
  .click(<span class="string"><span class="delimiter">&quot;</span><span class="content">button.create</span><span class="delimiter">&quot;</span></span>)
  .then(<span class="keyword">function</span>() {
    ok(find(<span class="string"><span class="delimiter">&quot;</span><span class="content">h1:contains('A new post')</span><span class="delimiter">&quot;</span></span>).length, <span class="string"><span class="delimiter">&quot;</span><span class="content">The post's title should display</span><span class="delimiter">&quot;</span></span>);
    ok(find(<span class="string"><span class="delimiter">&quot;</span><span class="content">a[rel=author]:contains('John Doe')</span><span class="delimiter">&quot;</span></span>).length, <span class="string"><span class="delimiter">&quot;</span><span class="content">A link to the author should display</span><span class="delimiter">&quot;</span></span>);
  });
});
</pre></td>
</tr></table>
</div></div><h3 class='anchorable-toc' id='toc_creating-your-own-test-helpers'>Creating your own test helpers</h3><h3 class='anchorable-toc' id='toc_'>创建自己的测试助手</h3>
<p><code>Ember.Test.registerHelper</code> is used to register a test helper that will be injected when <code>App.injectTestHelpers</code> is called.</p>

<p><code>Ember.Test.registerHelper</code>用于注册测试助手，这些助手会在<code>App.injectTestHelpers</code>被调用时被注入。</p>

<p>The helper method will always be called with the current Application as the first parameter. Helpers that cause asynchronous behavior should return <code>wait()</code> to return a promise that will resolve when that asynchronous behavior is complete.</p>

<p>测试助手总是作为当前应用的第一个参数来调用。如果一个测试助手会触发异步行为，那么它需要返回<code>wait()</code>，从而实现返回一个在异步行为完成后会履行的承诺。</p>

<p>For example:</p>
<div class="highlight javascript "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>Ember.Test.registerHelper(<span class="string"><span class="delimiter">'</span><span class="content">dblclick</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(app, selector, context) {
  <span class="keyword">var</span> <span class="predefined">$el</span> = findWithAssert(selector, context);
  Ember.run(<span class="keyword">function</span>() {
    <span class="predefined">$el</span>.dblclick();
  });
  <span class="keyword">return</span> wait();
});
</pre></td>
</tr></table>
</div></div><h3 class='anchorable-toc' id='toc_test-adapters-for-other-libraries'>Test adapters for other libraries</h3><h3 class='anchorable-toc' id='toc_'>其他测试库的适配器</h3>
<p>If you use a library other than QUnit, your test adapter will need to
provide methods for <code>asyncStart</code> and <code>asyncEnd</code>. To facilitate
asynchronous testing, the default test adapter for QUnit uses methods
that QUnit provides: (globals) <code>stop()</code> and <code>start()</code>.</p>

<p>如果使用QUnit之外的一个测试库，那么测试适配器需要提供<code>asyncStart</code>和<code>asyncEnd</code>两个方法。为了方便进行异步测试，QUnit的适配器使用QUnit提供的全局方法：<code>stop()</code>和<code>start()</code>。</p>

<p><strong>(Please note: Only development builds of Ember include the testing
package. The ember-testing package is not included in the production
build of Ember. The package can be loaded in your dev or qa builds to
facilitate testing your application. By not including the ember-testing
package in production, your tests will not be executable in a production
environment.)</strong></p>

<p><strong>（请注意：只有开发版本的Ember构建才包含测试包。ember-testing并不包含在生产环境版本的构建中。为了方便测试应用，可以将测试包包含在开发和质量保障的构建中。测试不应该能在一个生产环境中执行，因此不要生产环境中包含ember-testing包。）</strong></p>

    
      <footer>
        
          <a class="previous-guide" href="/bilingual_guides/enumerables">
             ← 枚举: 介绍
          </a>
         
          <a class="next-guide" href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">
             测试结束 下一章: 配置Ember.js - 禁用基本类型扩展 →
          </a>
        
      </footer>
      
  </div>

      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">&copy; 2013 Emberjs.CN <br/>Design by <a href="http://www.heropixel.com">HeroPixel</a></div>
        <div class="statement"><b>声明：</b>本站的文章可以随意在网上转载，但必须注明原文出处！</div>
        <div class="links">
          <a href="http://weibo.com/embercn"><img src="/images/weibo.png"/></a>
          <a href="http://emberjs.cn/blog/feed.xml"><img src="/images/feed.png"/></a>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0b0fcec01b06cc76e274f7b21f4766c4' type='text/javascript'%3E%3C/script%3E"));

      $(function() {
        $('a[href="http://tongji.baidu.com/hm-web/welcome/ico?s=0b0fcec01b06cc76e274f7b21f4766c4"]').hide();
      });
    </script>

  </body>
</html>
