

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="Description" content="Ember.js的中文开发者交流平台，提供Ember.js官方网站指南和API的中文翻译，持续关注最近的社区动态，为您提供高质量的Ember.js中文资料。 " />
    <meta name="Keywords" content="Ember.js、Ember、Javascript、Javascript框架、HTML、论坛、博客、中文社区" />
    <title>Ember.js - 运行循环</title>
    <link rel="shortcut icon" href="/images/favicon.png" />
    <!--[if lte IE 7 ]><link href="/stylesheets/fonts/fontello-ie7.css" media="screen" rel="stylesheet" type="text/css" /><![endif]-->
    <link href="/stylesheets/site.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/highlight.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/emberjs-cn.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="http://emberjs.cn/blog/feed.xml" rel="alternate" type="application/atom+xml" title="Ember.js CN - 博客" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      var pluginUrl = '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
      _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
      _gaq.push(['_setAccount', 'UA-38578402-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>

<!--[if lt IE 9]>
    <script type="text/javascript" src="/javascripts/common-old-ie.js"></script>
<![endif]-->
<!--[if gte IE 9]><!-->
    <script type="text/javascript" src="/javascripts/common-modern.js"></script>
<!--<![endif]-->

    
    <script type="text/javascript" src="/javascripts/guides.js"></script>
  
  </head>

  <body class="bilingual_guides bilingual_guides_understanding-ember bilingual_guides_understanding-ember_run-loop bilingual_guides_understanding-ember_run-loop_index">
    <div id="header">
      <div id="wrapper">
        <a id="logo" href="/">&nbsp;</a>
        <ul id="nav">
          <li><a href="/guides">指南</a></li>
          <li>
            <a target="_blank" href="http://discuss.emberjs.cn">论坛</a>
          </li>
          <li><a href="/blog">博客</a></li>
          <li>
            <a target="_blank" href="http://devdocs.io/ember/">API文档</a>
          </li>
          <li><a href="/builds">构建</a></li>
        </ul>
        <div id="github">
          <a href="https://github.com/emberjs-cn"><img src="/images/fork-us.png">Fork Us!</a>
          <a href="https://github.com/emberjs/ember.js"><img src="/images/fork-us.png">Fork Ember!</a>
        </div>
      </div>
    </div>

    <div id="content-wrapper">
      
      
        <div id="sidebar">
          
    <ol id="toc-list">
          <li class="level-1">
            <a href="/bilingual_guides/getting-started">入门指南</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/getting-started">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/planning-the-application">应用规划</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/creating-a-static-mockup">创建静态页面</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/obtaining-emberjs-and-dependencies">获取Ember.js和相应依赖</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/adding-a-route-and-template">添加第一个路由与模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/modeling-data">建立模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/using-fixtures">使用静态数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-model-data">显示模型数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-a-models-completeness">显示模型的完成状态</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/creating-a-new-model">创建新的模型实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/marking-a-model-as-complete-incomplete">标记模型为完成或未完成</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/displaying-the-number-of-incomplete-todos">显示未完成待办事项的数量</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/toggle-todo-editing-state">切换显示和编辑状态</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/accepting-edits">接受修改</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/deleting-todos">删除模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/adding-child-routes">添加子路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-only-incomplete-todos">显示未完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-only-complete-todos">显示已完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-all-todos-again">显示所有待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/display-a-button-to-remove-completed-todos">添加移除所有已完成待办事项的按钮</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/show-when-all-todos-are-complete">提示所有待办事项已完成</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/toggle-all-todos">切换已完成和未完成待办事项</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/getting-started/using-other-adapters">更换FixtureAdapter</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/getting-ember">获取Ember</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/getting-ember">获取Ember</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/concepts/core-concepts">概念</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/concepts/core-concepts">核心概念</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/concepts/naming-conventions">命名惯例</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/object-model/classes-and-instances">对象模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/object-model/classes-and-instances">类与实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties">计算属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/computed-properties-and-aggregate-data">计算属性和带@each的集合数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/observers">观察器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/bindings">绑定</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/reopening-classes-and-instances">重新打开类和实例</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/object-model/what-do-i-use-when">绑定，观察器，计算属性：如何选择？</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/application">应用</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/application">介绍</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/templates/the-application-template">模板</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/templates/the-application-template">应用模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/handlebars-basics">Handlebars基础</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/conditionals">条件表达式</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/displaying-a-list-of-items">显示项目列表</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/changing-scope">切换作用域</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-attributes">绑定元素属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/binding-element-class-names">绑定元素类名称</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/links">链接</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/actions">操作</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/input-helpers">输入助手</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/development-helpers">开发助手</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/rendering-with-helpers">用助手来渲染</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/templates/writing-helpers">编写助手方法</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/routing">路由</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/routing">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/defining-your-routes">定义路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/generated-objects">生成的对象</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-a-routes-model">指定路由的模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/setting-up-a-controller">设置控制器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/rendering-a-template">渲染模板</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/redirection">重定向</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/specifying-the-location-api">指定地址API</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/query-params">查询参数</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/asynchronous-routing">异步路由</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/loading-and-error-substates">加载中/错误子状态</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/routing/preventing-and-retrying-transitions">阻止和重试过渡</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/components">组件</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/components">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/defining-a-component">定义组件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/passing-properties-to-a-component">传递属性</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/wrapping-content-in-a-component">包裹内容</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/customizing-a-components-element">自定义组件元素</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/handling-user-interaction-with-actions">使用Action处理用户交互</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/components/sending-actions-from-components-to-your-application">从组件发送操作给应用</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/controllers">控制器</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/controllers">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-a-single-model-with-objectcontroller">代表单一模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/representing-multiple-models-with-arraycontroller">代表多模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/controllers/dependencies-between-controllers">管理控制器间的依赖</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/models">模型</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/models">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/defining-models">定义模型</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/creating-and-deleting-records">创建和删除记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/pushing-records-into-the-store">将记录推入仓库</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/persisting-records">持久化记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/finding-records">查询记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/working-with-records">使用记录</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/connecting-to-an-http-server">连接HTTP服务器</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/handling-metadata">处理元数据</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/models/frequently-asked-questions">常见问题</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/views">视图</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/views">介绍</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/defining-a-view">定义视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/handling-events">处理事件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/inserting-views-in-templates">在模板中插入视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/adding-layouts-to-views">为视图添加布局</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/customizing-a-views-element">自定义视图元素</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/built-in-views">内置视图</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/views/manually-managing-view-hierarchy">手动管理视图层级</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/enumerables">枚举</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/enumerables">介绍</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/testing/integration">测试</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/testing/integration">集成测试</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">配置Ember.js</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/disabling-prototype-extensions">禁用基本类型扩展</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/embedding-applications">嵌入式应用</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/configuring-ember/feature-flags">特性标识</a>
            </li>
          </ol></li>
          <li class="level-1">
            <a href="/bilingual_guides/cookbook">Cookbook</a>
            <ol>
        
            <li class="level-3">
              <a href="/bilingual_guides/cookbook">简介</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/user_interface_and_interaction">用户界面与交互</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/event_handling_and_data_binding">事件处理和数据绑定</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/helpers_and_components">助手与组件</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/cookbook/working_with_objects">使用对象</a>
            </li>
          </ol></li>
          <li class="level-1 selected">
            <a href="/bilingual_guides/understanding-ember/the-view-layer">理解Ember.js</a>
            <ol class='selected'>
        
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/the-view-layer">视图层</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/managing-asynchrony">管理异步</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/keeping-templates-up-to-date">模板自动更新</a>
            </li>
          
            <li class="level-3">
              <a href="/bilingual_guides/understanding-ember/debugging">调试</a>
            </li>
          
            <li class="level-3 sub-selected">
              <a href="/bilingual_guides/understanding-ember/run-loop">运行循环</a>
            </li>
          </ol></li></ol>
  
          <div id="back-to-top"><a id="back-top-top" href="#">&#11014; 返回顶部</a></div>
        </div>
      
      <div id="content" class="has-sidebar">
          
  

  <div class="chapter">
    
        <h1>运行循环 
          <a href="https://github.com/emberjs-cn/www.emberjs.cn/tree/master/source/guides/understanding-ember/run-loop.md" target="_blank" class="edit-page">
            编辑页面</a>
        </h1>
      
    <p>Ember&#39;s internals and most of the code you will write in your applications takes place in a run loop. The run loop is used to batch, and order (or reorder) work in a way that is most effective and efficient.</p>

<p>Ember内部及大部分为应用编写的代码都在一个运行循环中执行。运行循环用来做批量处理，并将任务以一种最高效的方式来执行。</p>

<p>It does so by scheduling work on specific queues. These queues have a priority,
and are processed to completion in priority order.</p>

<p>运行循环通过将工作分配到特定的队列来完成任务。队列具有优先级，并严格按照优先级来执行。</p>
<h2 class='anchorable-toc' id='toc_why-is-this-useful'>Why is this useful?</h2><h2 class='anchorable-toc' id='toc_'>为什么这样有用？</h2>
<p>Very often, batching similar work has benefits. Web browsers do something quite similar
by batching changes to the DOM.</p>

<p>通常批处理相似的工作都能得到好处。Web浏览器也实现了相似的批处理来完成对DOM的修改。</p>

<p>Consider the following HTML snippet:</p>

<p>考虑如下的HTML片段：</p>
<div class="highlight html "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
</pre></td>
  <td class="code"><pre><span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
<span class="tag">&lt;div</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">baz</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span><span class="tag">&lt;/div&gt;</span>
</pre></td>
</tr></table>
</div></div>
<p>and executing the following code:</p>

<p>并执行如下代码：</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
</pre></td>
  <td class="code"><pre>foo.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">500px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>
foo.offsetHeight <span class="comment">// read (recalculate style, layout, expensive!)</span>

bar.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">400px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>
bar.offsetHeight <span class="comment">// read (recalculate style, layout, expensive!)</span>

baz.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">200px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>
baz.offsetHeight <span class="comment">// read (recalculate style, layout, expensive!)</span>
</pre></td>
</tr></table>
</div></div>
<p>In this example, the sequence of code forced the browser to recalculate style,
and relayout after each step. However, if we were able to batch similar jobs together,
the browser would have only needed to recalulate the style and layout once.</p>

<p>在本例中，一系列代码要求浏览器重新计算样式，并在每步之后重新进行布局。然而，如果能够将相似的工作放在一起，那么浏览器就有可能只需要执行一次重新计算样式和重新布局。</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre>foo.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">500px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>
bar.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">400px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>
baz.style.height = <span class="string"><span class="delimiter">&quot;</span><span class="content">200px</span><span class="delimiter">&quot;</span></span> <span class="comment">// write</span>

foo.offsetHeight <span class="comment">// read (recalculate style, layout, expensive!)</span>
bar.offsetHeight <span class="comment">// read (fast since style and layout is already known)</span>
baz.offsetHeight <span class="comment">// read (fast since style and layout is already known)</span>
</pre></td>
</tr></table>
</div></div>
<p>Interestingly, this pattern holds true for many other types of work. Essentially,
batching similar work allows for better pipelining, and further optimization.</p>

<p>有趣的是，这种模式对于其他类型的工作也适用。本来将相似的工作进行批量处理就能得到较好的流水作业，也有利于进行深入的优化。</p>

<p>Let&#39;s look at a similar example that is optimized in Ember, starting with a <code>User</code> object:</p>

<p>下面从一个<code>User</code>对象开始，来看Ember优化的一个类似的例子：</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> User = Ember.Object.extend({
  <span class="key">firstName</span>: <span class="predefined-constant">null</span>,
  <span class="key">lastName</span>: <span class="predefined-constant">null</span>,
  <span class="function">fullName</span>: <span class="keyword">function</span>() {
    <span class="keyword">return</span> <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content"> </span><span class="delimiter">'</span></span> + <span class="local-variable">this</span>.get(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>);
  }.property(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>)
})
</pre></td>
</tr></table>
</div></div>
<p>and a template to display its attributes:</p>

<p>下面的模板用来显示其属性：</p>
<div class="highlight handlebars "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre><span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">firstName</span><span class="inline-delimiter">}}</span></span>
<span class="inline"><span class="inline-delimiter">{{</span><span class="attribute-name">fullName</span><span class="inline-delimiter">}}</span></span>
</pre></td>
</tr></table>
</div></div>
<p>If we execute the following code without the run loop:</p>

<p>如果不在运行循环中执行下列代码：</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> user = User.create({<span class="key">firstName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Tom</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Huda</span><span class="delimiter">'</span></span>});
user.set(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Yehuda</span><span class="delimiter">'</span></span>);
<span class="comment">// {{firstName}} and {{fullName}} are updated</span>

user.set(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Katz</span><span class="delimiter">'</span></span>);
<span class="comment">// {{lastName}} and {{fullName}} are updated</span>
</pre></td>
</tr></table>
</div></div>
<p>We see that the browser will rerender the template twice.</p>

<p>浏览器将会渲染模板两次。</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> user = User.create({<span class="key">firstName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Tom</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Huda</span><span class="delimiter">'</span></span>});
user.set(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Yehuda</span><span class="delimiter">'</span></span>);
user.set(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Katz</span><span class="delimiter">'</span></span>);

<span class="comment">// {{firstName}}  {{lastName}} and {{fullName}} are updated</span>
</pre></td>
</tr></table>
</div></div>
<p>However, if we have the run loop in the above code, the browser will only rerender the template once the attributes have all been set.</p>

<p>然后，如果上述代码在运行循环中执行，浏览器将会在所有属性都被设置好后，只重新渲染一次模板。</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="keyword">var</span> user = User.create({<span class="key">firstName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Tom</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>:<span class="string"><span class="delimiter">'</span><span class="content">Huda</span><span class="delimiter">'</span></span>});
user.set(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Yehuda</span><span class="delimiter">'</span></span>);
user.set(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Katz</span><span class="delimiter">'</span></span>);
user.set(<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Tom</span><span class="delimiter">'</span></span>);
user.set(<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Huda</span><span class="delimiter">'</span></span>);
</pre></td>
</tr></table>
</div></div>
<p>In the above example with the run loop, since the user&#39;s attributes end up at the same values as before execution, the template will not even rerender!</p>

<p>如上例所示，由于用户属性值最后并没有发生改变，当这段代码在运行循环中执行时，模板并不会被重新渲染！</p>

<p>It is of course possible to optimize these scenarios on a case-by-case basis,
but getting them for free is much nicer. Using the run loop, we can apply these
classes of optimizations not only for each scenario, but holistically app-wide.</p>

<p>当然这些场景也可以一个个问题来进行优化，然而能保持开放性相对来说更好。使用运行循环，可以为此类优化问题实现应用范围内的全局优化，而不单单是一个个场景。</p>
<h2 class='anchorable-toc' id='toc_how-does-the-run-loop-work-in-ember'>How does the Run Loop work in Ember?</h2><h2 class='anchorable-toc' id='toc_ember'>Ember中运行循环是如何工作的？</h2>
<p>As mentioned earlier, we schedule work (in the form of function invocations) on
queues, and these queues are processed to completion in priority order.</p>

<p>如之前所述，任务（函数调用）被分配到队列中，而队列会按照优先级来进行处理直到全部完成。</p>

<p>What are the queues, and what is their priority order?</p>

<p>那么都有些什么队列，它们的优先级又是怎么样排序的呢？</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>Ember.run.queues
<span class="comment">// =&gt; [&quot;sync&quot;, &quot;actions&quot;, &quot;routerTransitions&quot;, &quot;render&quot;, &quot;afterRender&quot;, &quot;destroy&quot;]</span>
</pre></td>
</tr></table>
</div></div>
<p>Because the priority is first to last, the &quot;sync&quot; queue has higher priority than the &quot;render&quot; or &quot;destroy&quot; queue.</p>

<p>由于优先级是从前至后的，因此&quot;sync&quot;队列的优先级比&quot;render&quot;或者&quot;destroy&quot;队列的要高。</p>
<h2 class='anchorable-toc' id='toc_what-happens-in-these-queues'>What happens in these queues?</h2><h2 class='anchorable-toc' id='toc_'>这些队列里面都发生了些什么？</h2>
<ul>
<li><p>The <code>sync</code> queue contains binding synchronization jobs</p></li>
<li><p><code>sync</code>队列包含绑定同步的任务</p></li>
<li><p>The <code>actions</code> queue is the general work queue and will typically contain scheduled tasks e.g. promises</p></li>
<li><p><code>actions</code>队列是最普通的工作队列，通常包含待执行的计划任务。例如：承诺</p></li>
<li><p>The <code>routerTransitions</code> queue contains transition jobs in the router</p></li>
<li><p><code>routerTransitions</code>队列包含路由的转换任务</p></li>
<li><p>The <code>render</code> queue contains jobs meant for rendering, these will typically update the DOM</p></li>
<li><p><code>render</code>队列包含将要进行渲染的任务，通常都是对DOM的更新操作</p></li>
<li><p>The <code>afterRender</code> contains jobs meant to be run after all previously scheduled render tasks are complete. This is often good for 3rd-party DOM manipulation libraries, that should only be run after an entire tree of DOM has been updated</p></li>
<li><p><code>afterRender</code>包含之前计划进行渲染的任务完成后需要执行的任务。对于第三方修改DOM的库来说非常有用，因为这意味着任务会在DOM全部被更新后才执行</p></li>
<li><p>The <code>destroy</code> queue contains jobs to finish the teardown of objects other jobs have scheduled to destroy</p></li>
<li><p><code>destroy</code>队列包含完成其他任务计划销毁额对象的清理任务</p></li>
</ul>
<h2 class='anchorable-toc' id='toc_in-what-order-are-jobs-executed-on-the-queues'>In what order are jobs executed on the queues?</h2><h2 class='anchorable-toc' id='toc_'>队列中的任务以什么顺序执行？</h2>
<p>The algorithm works this way:</p>

<p>算法按照下面的方式工作：</p>

<ol>
<li>Let the highest priority queue with pending jobs be: <code>CURRENT_QUEUE</code>, if there are no queues with pending jobs the run loop is complete</li>
<li>Let a new temporary queue be defined as <code>WORK_QUEUE</code></li>
<li>Move jobs from <code>CURRENT_QUEUE</code> into <code>WORK_QUEUE</code></li>
<li>Process all the jobs sequentially in <code>WORK_QUEUE</code></li>
<li><p>Return to Step 1</p></li>
<li><p>将包含等待任务的具有最高优先级的队列设置为<code>CURRENT_QUEUE</code>，如果没有任何队列中包含等待执行的任务，运行循环完成</p></li>
<li><p>将一个新的临时队列定义为<code>WORK_QUEUE</code></p></li>
<li><p>将<code>CURRENT_QUEUE</code>中的任务移动到<code>WORK_QUEUE</code>中</p></li>
<li><p>按顺序处理<code>WORK_QUEUE</code>中的所有任务</p></li>
<li><p>返回第一步开始执行</p></li>
</ol>
<h2 class='anchorable-toc' id='toc_an-example-of-the-internals'>An example of the internals</h2><h2 class='anchorable-toc' id='toc_'>内部示例</h2>
<p>Rather than writing the higher level app code that internally invokes the various
run loop scheduling functions, we have stripped away the covers, and shown the raw run-loop interactions.</p>

<p>与编写高层的应用代码不同，Ember内部会调用各种运行循环来计划函数的执行，这里拨开所有的面纱，直接展示原始的运行循环交互。</p>

<p>Working with this API directly is not common in most Ember apps, but understanding this example will
help you to understand the run-loops algorithm, which will make you a better Ember developer.</p>

<p>大部分Ember应用并不需要直接操作这些API，但是理解本示例将能更好的理解运行循环算法，有助于成为更为优秀的Ember开发者。</p>

<iframe src="http://emberjs.com.s3.amazonaws.com/run-loop-guide/index.html" width="678" height="410" style="border:1px solid rgb(170, 170, 170);margin-bottom:1.5em;"></iframe>
<h2 class='anchorable-toc' id='toc_faqs'>FAQs</h2><h2 class='anchorable-toc' id='toc_'>常见问题</h2><h4 class='anchorable-toc' id='toc_what-do-i-need-to-know-to-get-started-with-ember'>What do I need to know to get started with Ember?</h4><h4 class='anchorable-toc' id='toc_ember'>对于Ember入门需要了解哪些内容？</h4>
<p>For basic Ember app development scenarios, nothing. All common paths are paved nicely
for you and don&#39;t require working with the run loop directly.</p>

<p>对于基础的Ember应用开发场景，不需要了解任何关于运行循环的内容。所有道路已经铺设完毕，可以完全不需要与运行循环打交道。</p>
<h4 class='anchorable-toc' id='toc_what-do-i-need-to-know-to-actually-build-an-app'>What do I need to know to actually build an app?</h4><h4 class='anchorable-toc' id='toc_'>对于编写一个实际的应用需要了解哪些内容？</h4>
<p>It is possible to build good apps without working with the run loop directly, so if
you don&#39;t feel the need to do so, don&#39;t.</p>

<p>不直接使用运行循环并不影响构建一个好的应用，因此能不用就不要用。</p>
<h4 class='anchorable-toc' id='toc_what-scenarios-will-require-me-to-understand-the-run-loop'>What scenarios will require me to understand the run loop?</h4><h4 class='anchorable-toc' id='toc_'>哪些场景需要理解运行循环？</h4>
<p>The most common case you will run into is integrating with a non-Ember API
that includes some sort of asynchronous callback. For example:</p>

<p>最常见的问题是集成一个非Ember接口的异步回调。例如：</p>

<ul>
<li>AJAX callbacks</li>
<li>DOM update and event callbacks</li>
<li>Websocket callbacks</li>
<li><code>setTimeout</code> and <code>setInterval</code> callbacks</li>
<li><p><code>postMessage</code> and <code>messageChannel</code> event handlers</p></li>
<li><p>AJAX回调</p></li>
<li><p>DOM更新和事件回调</p></li>
<li><p>Websocket回调</p></li>
<li><p><code>setTimeout</code>和<code>setInterval</code>回调</p></li>
<li><p><code>postMessage</code>和<code>messageChannel</code>事件处理器</p></li>
</ul>

<p>You should begin a run loop when the callback fires.</p>

<p>在回调被出发时，应该开始一个运行循环。</p>
<h4 class='anchorable-toc' id='toc_how-do-i-tell-ember-to-start-a-run-loop'>How do I tell Ember to start a run loop?</h4><h4 class='anchorable-toc' id='toc_ember'>如何通知Ember开始一个运行循环？</h4><div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre><span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).click(<span class="keyword">function</span>(){
  Ember.run(<span class="keyword">function</span>(){  <span class="comment">// begin loop</span>
    <span class="comment">// Code that results in jobs being scheduled goes here</span>
  }); <span class="comment">// end loop, jobs are flushed and executed</span>
})
</pre></td>
</tr></table>
</div></div><h4 class='anchorable-toc' id='toc_what-happens-if-i-forget-to-start-a-run-loop-in-an-async-handler'>What happens if I forget to start a run loop in an async handler?</h4><h4 class='anchorable-toc' id='toc_'>如果忘记在一个异步处理器中启动一个运行循环会发生什么？</h4>
<p>As mentioned above, you should wrap any non-Ember async callbacks in <code>Ember.run</code>.
If you don&#39;t, Ember will try to approximate a beginning and end for you. Here
is some pseudocode to describe what happens:</p>

<p>如上所述，任何非Ember的异步回调应该放到<code>Ember.run</code>中。如果没有，Ember会尝试自动添加一个。下面是一个大概会发生的情况的示例代码：</p>
<div class="highlight js "><div class="ribbon"></div><div class="scroller"><table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
<strong>10</strong>
11
</pre></td>
  <td class="code"><pre><span class="predefined">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).click(<span class="keyword">function</span>(){
  <span class="comment">// Ember or runloop related code.</span>
  Ember.run.start();

  <span class="comment">// 1. we detect you need a run-loop</span>
  <span class="comment">// 2. we start one for you, but we don't really know when it ends, so we guess</span>

  nextTick(<span class="keyword">function</span>() { 
    Ember.run.end()
  }, <span class="integer">0</span>);
})
</pre></td>
</tr></table>
</div></div>
<p>This is suboptimal because the current JS frame is allowed to end before the run loop is
flushed, which sometimes means the browser will take the opportunity to do other things,
like garbage collection. GC running in between data changing and DOM rerendering can cause visual lag and should be minimized.</p>

<p>这样做并没有达到最佳效果，因为当前的JS依然允许在运行循环清空前结束，这样就意味着有时候浏览器会有机会去做一些其他的事情，例如垃圾回收。垃圾回收如果在数据变更和DOM重新渲染的过程中执行，会导致明显的延迟，应该竟可能避免。</p>
<h4 class='anchorable-toc' id='toc_when-i-am-in-testing-mode-why-are-run-loop-autoruns-disabled'>When I am in testing mode, why are run-loop autoruns disabled?</h4><h4 class='anchorable-toc' id='toc_'>在测试模式下，为什么运行循环自动运行是被关闭的？</h4>
<p>Some of Ember&#39;s test helpers are promises that wait for the run loop to empty before resolving. This leads to resolving too early if there is code that is outside the run loop and gives erroneous test failures. Disabling autoruns help you identify these scenarios and helps both your testing and your application!</p>

<p>一些Ember测试助手都是承诺，需要等待运行循环为空才能履行。如果有代码不在运行循环内，会导致其过早履行，并给出错误的测试失败。关闭自动运行可以帮助找到这些场景，能为测试和应用都带来帮助。</p>

    
      <footer>
        
          <a class="previous-guide" href="/bilingual_guides/understanding-ember/debugging">
            ← 调试
          </a>
         
      </footer>
      
  </div>

      </div>
    </div>

    <div id="footer">
      <div id="footer-wrapper">
        <div class="info">&copy; 2014 Emberjs.CN <br/>Design by <a href="http://www.heropixel.com">HeroPixel</a></div>
        <div class="statement"><b>声明：</b>本站的文章可以随意在网上转载，但必须注明原文出处！</div>
        <div class="links">
          <a href="http://weibo.com/embercn"><img src="/images/weibo.png"/></a>
          <a href="http://emberjs.cn/blog/feed.xml"><img src="/images/feed.png"/></a>
        </div>
      </div>
    </div>

    <script type="text/javascript">
      var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
      document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F0b0fcec01b06cc76e274f7b21f4766c4' type='text/javascript'%3E%3C/script%3E"));

      $(function() {
        $('a[href="http://tongji.baidu.com/hm-web/welcome/ico?s=0b0fcec01b06cc76e274f7b21f4766c4"]').hide();
      });
    </script>

  </body>
</html>
